---
title: "Poročilo pri predmetu Analiza podatkov s programom R"
author: "Žan Šifrer"
output:
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
---

```{r setup, echo=FALSE, results='hide', message=FALSE}
# Če želimo nastaviti pisave v PDF-ju, odkomentiramo
# in sledimo navodilom v programu.
#source("fontconfig.r", encoding = "UTF-8")

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding = "UTF-8")
```

# Izbira teme

Analiza podatkov LaLige v letu 2014/15

Analiziral bom špansko prvo nogometno ligo LaLigo. Iz podatkov bom ugotovil kakšne so razlike med ekipami v njej, katere ekipe povprečno dajejo več golov, katere več tvegajo. Analiziral bom kakšna so razmerja med zmagami in porazi pri ekipah in katere ekipe bolje igrajo na začetku sezone, katere na koncu in kakšno gol razliko dosežejo. 

Podatke si bom pridobil na spletu:

    http://www.soccerstats.com/latest.asp?league=spain_2015
    https://en.wikipedia.org/wiki/2014%E2%80%9315_La_Liga

***

# Obdelava, uvoz in čiščenje podatkov

```{r uvoz, echo=FALSE}
source("uvoz/uvoz.r", encoding = "UTF-8")
```
Uvozil sem podatke iz spletnih strani tako da sem lestvico in pozicije po posameznih krogih v sezoni prekopiral v excel in shranil v csv formatu, saj so bile lestvice večinoma na takih spletnih straneh kjer nisem mogel direktno dobiti samo tabele. Nato sem tabelo prevedel in premenil imena stolpcev tako da je razvidno kaj prikazuje vsak stolpec. V tabeli podatki imam lestvico ekip iz lanskoletne LaLige po vrsti glede na točke. V njej so podatki koliko tekem so odigrali, koliko so dosegli zmag, izenačenih izidov in porazov, koliko so dali golov in koliko dobili in tudi razliko med danimi in dobljenimi goli, nazadnje pa še točke po katerih se seveda odloča o lestvici.

Dodal sem stolpce z razmerjem med zmagami in porazi, koliko golov je na njihovih tekmah in v koliko procentih igrajo izenačen izid.
```{r podatki, echo=FALSE}
kable(podatki[c(2,3,4,5,6,9,10,11,12)])
kable(t(pozicije))

```

```{r razpredelnice, echo=FALSE}
#kable(head(druzine))

```

```{r točke in gol razlika, echo=FALSE}
ggplot(data=podatki , aes(x=Position,y=Points))+ geom_point(aes(size= fillgolrazlika),colour="red")
```

Graf prikazuje koliko točk so dosegle ekipe po vrsti in velikost točk nam pove kako dobro gol razliko so dosegli. iz njega lahko razberemo kako se ekipe razlikujejo od najboljše do najslabše, videti je da Barcelona in Real madrid dosti izstopata od ostalih ekip, namreč Real Madrid je 14 točk pred tretjeuvrščenim Atletico Madridom, ki pa je skupaj z Valencio in Sevillio tudi dosti oddaljen od ostalih ekip, ki nekako enakomerno padajo. Vidi se tudi da gol razlike pribljižno enakomerno padajo, razen pri zadnjih 7ih ekipah nekako nihajo.

```{r zmage proti porazom, echo=FALSE}
ggplot(data=podatki , aes(x=Position,y=Wins/Loses))+ geom_line(aes(size=Draws/Played))
```

Pri naslednjem grafu je prikazano razmerje med zmagami in porazi, debelina črt pa je delež izenačenih izidov. kot vidimo v temu razmerju kar močno izstopa vodilna ekipa Barcelona, Real Madrid je za njo samo 2 točki, ampak ker imajo vodilne ekipe veliko zmag in malo porazov sta 2 poraza več povzročila tak padec, imeli so pa najmanj izenačenih izidov, kar se tudi vidi po debelini črte. Atletico Madrid je imel slabše razmerje med zmagami in porazi od četrteuvrščene Valencie, ki je dosegla 1 zmago in en poraz manj. Do nekje 7-ga mesta je to razmerje močno padlo, pri ostalih ekipah pa so le manjše razlike.

```{r dani goli proti prejetim, echo=FALSE}
FA = podatki$'Goals For'/podatki$'Goals Against'
gpm = podatki$`Goals per match`
ggplot(data=podatki , aes(x=Position,y=FA))+ geom_line(aes(size=gpm,color="blue"))+ geom_line(aes(y=1))
```

Analiziral sem tudi koliko ekipe dajejo golov, ko prejmejo enega. debelina črte predstavlja koliko golov je povprečno na tekmo. Ponovno se vidi kako vodilne ekipe izstopajo iz povprečja namreč vodilna Barcelona je v povprečju dala več kot 5 golov na enega prejetega. Do 7-ega mesta to razmerje močno pada od tam naprej pa imajo ekipe manj danih golov kot prejetih. Razvidno je tudi da je najmanj golov na tekmo pri ekipah najbljižjim razmerju 1, glede na to se mi tudi zdi da take ekipe najmanj tvegajo.



```{r histogram, echo=FALSE, fig.align='center', fig.cap='Histogram števila naselij v občinah'}
#hist(obcine[,4], main = "Pogostost števila naselij",
 #    xlab = "Število naselij", ylab = "Število občin")
```

***

# Analiza in vizualizacija podatkov

```{r vizualizacija, echo=FALSE}
#source("vizualizacija/vizualizacija.r", encoding = "UTF-8")
```

Slika \ref{fig:zemljevid} prikazuje povprečno velikost družine za vsako občino.

```{r zemljevid, echo=FALSE, fig.align='center', fig.cap='Zemljevid povprečnega števila otrok v družini'}
#n <- 100
#barve <- topo.colors(n)[1+(n-1)*(druzine$povprecje-min.povprecje)/(max.povprecje-min.povprecje)]
#plot(zemljevid, col = barve)
#title("Povprečno število otrok v družini")
```

***

# Napredna analiza podatkov

```{r analiza, echo=FALSE}
#source("analiza/analiza.r", encoding = "UTF-8")
```

Slika \ref{fig:graf} prikazuje povezavo med številom naselij in površino občine.

```{r graf, echo=FALSE, fig.align='center', fig.cap='Povezava med številom naselij in površino občine'}
#plot(obcine[[1]], obcine[[4]],
 #    main = "Število naselij glede na površino občine",
#     xlab = expression("Površina (km"^2 * ")"),
 #    ylab = "Št. naselij",
  #   col = barve[obcine[[7]]],
   #  pch = 18)
#legend("topright", legend = names(barve), col = barve,
 #      pch = 18, cex = 0.5, bg = "white")
```

***